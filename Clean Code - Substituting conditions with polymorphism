using System;
using System.Collections.Generic;
using System.Linq;

namespace FileCourse
{
    class Program
    {
        static void Main(string[] args)
        {
            OrderForm orderForm = new OrderForm();
        }
    }

    public class OrderForm
    {      
        public OrderForm(List<PaymentSystem> paymentSystems)
        {    
            foreach (PaymentSystem paymentSystem in paymentSystems)
                Button button = new Button (paymentSystem.Name, paymentSystem.SystemId);
            Console.WriteLine("Выберите способ платежа...");
        }
    }

    public static class PaymentSystems 
    {
        public static IReadOnlyList<PaymentSystem> AvailableSystems = new List<PaymentSystem>
        {new CardPaymentSystem(),
        new WebMoneyPaymentSystem(),
        new QiwiPaymentSystem()};

        public void TryPay(string systemId)
        {
            PaymentSystem chosenSystem = AvailableSystems.FirstOrDefault(paymentSystem => paymentSystem.SystemId == systemId);

            if (chosenSystem?) 
                throw new ArgumentNullExceeption(nameof(systemId), "Payment system with indicated Id is not registered")

            chosenSystem.Pay();
        }
    }

    public class CardPaymentSystem : PaymentSystem
    {
        public CardPaymentSystem() : base("Card", "PS2") { }

        protected override void CallWebInterface()
        {
            Console.WriteLine($"Вызов API банка эмитера карты {Name}...");
            //симуляция веб интерфейса под Card
        }
    }

    public class WebMoneyPaymentSystem : PaymentSystem
    {
        public WebMoneyPaymentSystem() : base("WebMoney", "PS1") { }

        protected override void CallWebInterface()
        {
            Console.WriteLine($"Вызов API {Name}...");
            //симуляция веб интерфейса под WebMoney
        }
    }

    public class QiwiPaymentSystem : PaymentSystem
    {
        public QiwiPaymentSystem() : base("QIWI", "PS0") { }

        protected override void CallWebInterface()
        {
            Console.WriteLine($"Перевод на страницу {Name}...");
            //симуляция веб интерфейса под QIWI
        }
    }

    public abstract class PaymentSystem : IPaymentSystem
    {       
        public PaymentSystem(string name, int systemId) 
        {
            Name = name;
            SystemId = systemId;
        }

        public string Name { get;}
        public int SystemId { get;}

        public void Pay()
        {
            CallWebInterface();
            ShowPaymentResult();
        }

        protected abstract void CallWebInterface();

        private void ShowPaymentResult()
        {
            Console.WriteLine($"Вы оплатили с помощью {Name}");
            Console.WriteLine($"Проверка платежа через {Name}...");
            Console.WriteLine("Оплата прошла успешно!");
        }
    }

    public class Button
    {
        public string _systemId {get;}
        public string _caption {get;}

        public Button (string systemId, string caption)
        {
            _systemId = systemId;
            _caption = caption;
        }

        public string OnButtonPressed()
        {
            PaymentSystems.TryPay(_systemId)
        }
    }

    public interface IPaymentSystem
    {
        void Pay();
    }
}
